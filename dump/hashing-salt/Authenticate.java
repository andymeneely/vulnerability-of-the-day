import java.io.FileNotFoundException;
import java.security.MessageDigest;
import java.util.Scanner;

import org.apache.commons.codec.binary.Base64;

public class Authenticate {

	private static String storedPassword;

	public static void main(String[] args) throws Exception {
		System.out.print("Type in the password to set (try \"password\"): ");
		Scanner scanner = new Scanner(System.in);
		String password = scanner.nextLine();
		System.out.println("Here are some digests: ");
		System.out.println("\tPlaintext: " + password);
		System.out.println("\tHashed by SHA-256: " + sha256(password) + " (try Googling it...)");
		System.out.println("\tHashed by salted SHA-256: " + saltedSha256(password));
		storedPassword = saltedSha256(password);
		System.out.println("Stored the salted SHA-256. Without the salt, nobody can crack it.");
		System.out.print("Ok, now it's time to authenticate against the salted password. \nType in that password again:");
		password = scanner.nextLine();
		if (saltedSha256(password).equals(storedPassword)) {
			System.out.println("Authenticated!!");
		} else {
			System.out.println("Passwords did not match.");
		}
		scanner.close();
	}

	private static String sha256(String password) throws Exception {
		MessageDigest digest = MessageDigest.getInstance("SHA-256");
		return new String(Base64.encodeBase64(digest.digest(password.getBytes())));
	}

	private static String saltedSha256(String password) throws Exception {
		return sha256(password + getSalt());
	}

	private static String getSalt() throws FileNotFoundException {
		Scanner scanner = new Scanner(Authenticate.class.getResourceAsStream("secret-salt.txt"));
		String salt = scanner.nextLine();
		scanner.close();
		return salt;
	}

}
