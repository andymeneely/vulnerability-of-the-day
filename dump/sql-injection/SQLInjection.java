import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Scanner;

public class SQLInjection {
	public static void main(String[] args) throws Exception {
		Class.forName("org.h2.Driver").newInstance();
		Connection conn = DriverManager.getConnection("jdbc:h2:mem:db1", "", "");
		conn.createStatement().execute("CREATE TABLE Users(Username VARCHAR(255), Password VARCHAR(255))");
		conn.createStatement().execute("INSERT INTO Users(Username,Password) VALUES ('bobby','tables')");

		System.out.print("Enter username: ");
		Scanner scanner = new Scanner(System.in);
		String user = scanner.nextLine();
		System.out.print("Enter password: ");
		String password = scanner.nextLine();
		System.out.println(authenticate(user, password, conn));

		conn.close();
	}

	private static String authenticate(String user, String password, Connection conn) throws SQLException {
		ResultSet resultSet = conn.createStatement().executeQuery(
				"SELECT * FROM Users WHERE Username='" + user + "' AND Password='" + password + "'");
		if (resultSet.next()) // any rows?
			return "Authenticated!!";
		else
			return "Not authenticated!!";
	}

	private static String authenticateSecurely(String user, String password, Connection conn) throws SQLException {
		PreparedStatement ps = conn.prepareStatement("SELECT * FROM Users WHERE Username=? AND Password=?");
		ps.setString(1, user);
		ps.setString(2, password);
		ResultSet resultSet = ps.executeQuery();
		if (resultSet.next()) // any rows?
			return "Authenticated!!";
		else
			return "Not authenticated!!";
	}

}
